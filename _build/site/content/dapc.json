{"kind":"Notebook","sha256":"a83bbf9b23775d187f2d8a61aab6468e3d26ff605f489b0350bf5004c1920ff1","slug":"dapc","location":"/2025-Tablacares_popgen/DAPC/dapc.ipynb","dependencies":[],"frontmatter":{"title":"Setup the data","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"exports":[{"format":"ipynb","filename":"dapc.ipynb","url":"/dapc-e480486911e4f852316091dd1254cf68.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"collapsed":true,"execution":{"iopub.execute_input":"2021-08-16T18:39:23.535Z","iopub.status.busy":"2021-08-16T18:39:23.528Z","iopub.status.idle":"2021-08-16T18:39:23.547Z","shell.execute_reply":"2021-08-16T18:39:23.570Z"},"jupyter":{"outputs_hidden":true,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"library(\"adegenet\")\nsuppressPackageStartupMessages(library(tidyverse))\nlibrary(ggplot2)\nlibrary(ggpubr)\nsetwd(\"~/Omega/USM PhD/Projects/Active/Yellowfin Tuna/Popgen/Analyses/nonkin/DAPC\")\n","key":"tyVRnzdb3s"},{"type":"output","id":"geSkY_oACzp9lwrlJpQOK","data":[],"key":"QbvE9V4LvK"}],"key":"Ir2NG5eZAD"},{"type":"block","kind":"notebook-content","data":{"nteract":{"transient":{"deleting":false}}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup the data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eqDXXhyhFG"}],"identifier":"setup-the-data","label":"Setup the data","html_id":"setup-the-data","implicit":true,"key":"KmctDztXey"}],"key":"nOkM3s74E4"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"execution":{"iopub.execute_input":"2021-08-16T18:39:23.561Z","iopub.status.busy":"2021-08-16T18:39:23.554Z","iopub.status.idle":"2021-08-16T18:39:35.890Z","shell.execute_reply":"2021-08-16T18:39:35.916Z"},"jupyter":{"outputs_hidden":true,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"i <- \"neutral\"\ninfile <- paste0(\"YFT.snp.kinrm.pcrelate.\", i, \".gen\")\ndata <- read.genepop(infile, ncode = 3L)\nPopNames <- c(\"ATL\",\"GOM\",\"IVC\", \"SEN\", \"TX\", \"VZ\")\npopNames(data) <- PopNames\nmetadata <- read_table(\"metadata.txt\", col_names = TRUE)","key":"gsPSg4iFXz"},{"type":"output","id":"gTehGOysMKnKLf9YfT_9f","data":[{"name":"stdout","output_type":"stream","text":"\n Converting data from a Genepop .gen file to a genind object... \n\n\nFile description:  genepop generated from PopData by PopGen.jl \n\n...done.\n\n"},{"name":"stderr","output_type":"stream","text":"\n\u001b[36m──\u001b[39m \u001b[1m\u001b[1mColumn specification\u001b[1m\u001b[22m \u001b[36m────────────────────────────────────────────────────────\u001b[39m\ncols(\n  name = \u001b[31mcol_character()\u001b[39m,\n  population = \u001b[31mcol_character()\u001b[39m,\n  year = \u001b[32mcol_double()\u001b[39m\n)\n\n\n"}],"key":"HeyQlnXrkB"}],"key":"aBvR8DmJsc"},{"type":"block","kind":"notebook-content","data":{"nteract":{"transient":{"deleting":false}}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"K-means clustering","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ySq33pI5Uu"}],"identifier":"k-means-clustering","label":"K-means clustering","html_id":"k-means-clustering","implicit":true,"key":"xHBlhKGdzn"}],"key":"L9TIJK2N8x"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"execution":{"iopub.execute_input":"2021-08-16T18:39:35.906Z","iopub.status.busy":"2021-08-16T18:39:35.899Z","iopub.status.idle":"2021-08-16T18:41:55.255Z","shell.execute_reply":"2021-08-16T18:41:55.244Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"maxK <- 7\nmyMat <- matrix(nrow=50, ncol=maxK)\ncolnames(myMat) <- 1:maxK\nfor(i in 1:nrow(myMat)){\n  grp <- find.clusters(data, n.pca = 298, choose.n.clust = FALSE,  max.n.clust = maxK)\n  myMat[i,] <- grp$Kstat\n  #print(grp$Kstat)\n}","key":"TZDK2Cta1k"},{"type":"output","id":"fV_c2I_SdhrXdfBveVcyi","data":[],"key":"Mk4c7O8qI0"}],"key":"Wg5rCFbVJK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-08-16T18:41:55.271Z","iopub.status.busy":"2021-08-16T18:41:55.265Z","iopub.status.idle":"2021-08-16T18:41:55.495Z","shell.execute_reply":"2021-08-16T18:41:55.527Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"k_df <- reshape2::melt(myMat)\ncolnames(k_df)[1:3] <- c(\"Group\", \"K\", \"BIC\")\nk_df$K <- as.factor(k_df$K)\n\nk_plot <- k_df %>% \n  ggplot(aes(x = K, y = BIC)) +\n  geom_boxplot() +\n  theme_bw() +\n  labs(title = \"K-means Clustering\") +\n  ylab(\"Bayesian Information Criterion (BIC)\") +\n  xlab(\"Number of groups (K)\")\nk_plot","key":"PI3FWdfseA"},{"type":"output","id":"FiR6IC_kIgqm_Ujef2V1t","data":[{"output_type":"display_data","metadata":{"image/png":{"height":420,"width":420}},"data":{"image/png":{"content_type":"image/png","hash":"3ed47eac403b686aa781c2b4691e064d","path":"/3ed47eac403b686aa781c2b4691e064d.png"},"text/plain":{"content":"plot without title","content_type":"text/plain"}}}],"key":"xUXKviz1bP"}],"key":"HOGUSdY7cQ"},{"type":"block","kind":"notebook-content","data":{"nteract":{"transient":{"deleting":false}}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"DAPC","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ectgA6Ho1n"}],"identifier":"dapc","label":"DAPC","html_id":"dapc","implicit":true,"key":"crpH3hFcMi"}],"key":"XrfaO4l8jv"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"execution":{"iopub.execute_input":"2021-08-16T18:41:55.514Z","iopub.status.busy":"2021-08-16T18:41:55.506Z","iopub.status.idle":"2021-08-16T18:41:57.738Z","shell.execute_reply":"2021-08-16T18:41:57.728Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"by_location <- dapc(data, pop = metadata$population, perc.pca = 85, n.da = 4)\n","key":"XjEBn68cwv"},{"type":"output","id":"WJJpXTyV_u8k-gFIZYUpk","data":[],"key":"p21eOPl2OJ"}],"key":"Elb4PVi3UL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-08-16T18:41:57.754Z","iopub.status.busy":"2021-08-16T18:41:57.748Z","iopub.status.idle":"2021-08-16T18:41:58.033Z","shell.execute_reply":"2021-08-16T18:41:58.061Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"my_pal <- RColorBrewer::brewer.pal(n=6, name = \"Dark2\")\n\ndapc_l <- by_location\nmy_df <- as.data.frame(dapc_l$ind.coord)\nmy_df$Group <- dapc_l$grp\n\ndf <- as.data.frame(by_location$ind.coord)\ndf <- cbind(metadata$name, metadata$population, df)\nnames(df) <- c(\"name\", \"population\", \"LD1\", \"LD2\", \"LD3\", \"LD4\")\ndf$population <- df$population <- factor(df$population, levels = c(\"GOM\", \"TX\", \"VZ\", \"ATL\", \"SEN\", \"IVC\"), ordered = TRUE)\n\n\ndapc_plot <- df %>% \n  ggplot(aes(x = LD1, y = LD2, color = population, fill = population)) +\n  geom_point(size = 4, shape = 21) +\n  stat_ellipse(show.legend = FALSE) +\n  labs(title = \"DAPC (neutral markers)\") +\n  xlab(\"Linear Discriminant 1\") +\n  ylab(\"Linear Discriminant 2\") +\n  theme_bw() +\n  scale_color_manual(values=c(my_pal)) +\n  scale_fill_manual(values=c(paste(my_pal, \"96\", sep = \"\")))\ndapc_plot","key":"Zice6BhNUx"},{"type":"output","id":"Bg88tN7adNVdcO-OM4KbL","data":[{"output_type":"display_data","metadata":{"image/png":{"height":420,"width":420}},"data":{"image/png":{"content_type":"image/png","hash":"9ca55206889508b72acc452f2bd5a54d","path":"/9ca55206889508b72acc452f2bd5a54d.png"},"text/plain":{"content":"plot without title","content_type":"text/plain"}}}],"key":"c3wHUfzeCH"}],"key":"esHZFuuz9M"},{"type":"block","kind":"notebook-content","data":{"nteract":{"transient":{"deleting":false}}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Structure-like plots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"by3UNJWiSj"}],"identifier":"structure-like-plots","label":"Structure-like plots","html_id":"structure-like-plots","implicit":true,"key":"XpLnRo253A"}],"key":"J7LbIVmtPj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-08-16T18:41:58.049Z","iopub.status.busy":"2021-08-16T18:41:58.043Z","iopub.status.idle":"2021-08-16T18:41:58.526Z","shell.execute_reply":"2021-08-16T18:41:58.551Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"tmp <- as.data.frame(dapc_l$posterior)\ntmp <- cbind(metadata$name, metadata$population, tmp)[,1:8] #drop redundant col\nnames(tmp) <- c(\"name\", \"origin\", \"ATL\",\"GOM\",\"IVC\",\"SEN\",\"TX\",\"VZ\")\ntmp <- pivot_longer(tmp, c(-name, -origin), names_to = \"population\", values_to = \"posterior\")\ntmp$population <- factor(tmp$population, levels = c(\"GOM\", \"TX\", \"VZ\", \"ATL\", \"SEN\", \"IVC\"), ordered = TRUE)\ntmp$origin <- factor(tmp$origin, levels = c(\"GOM\", \"TX\", \"VZ\", \"ATL\", \"SEN\", \"IVC\"), ordered = TRUE)\n\n\nposterior_plot <- tmp %>% \n  ggplot(aes(x = name, y = posterior, fill = population)) +\n  geom_bar(stat = \"identity\", width = 1.0) +\n  scale_fill_manual(values=c(my_pal)) +\n  labs(title = \"Posterior Membership Probability (K=4)\") +\n  ylab(\"Posterior membership probability\") +\n  xlab(\"Samples\") +\n  facet_grid(~origin, scales = \"free_x\", space = \"free\" ) + \n  theme_bw() +\n  guides(fill=guide_legend(title=\"Membership\")) +\n  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +\n  coord_cartesian(ylim = c(0, 1), expand = FALSE, clip = \"off\")\nposterior_plot","key":"GFijrhcZwq"},{"type":"output","id":"ZVcZWI-uJN2VLyPKjD6cg","data":[{"output_type":"display_data","metadata":{"image/png":{"height":420,"width":420}},"data":{"image/png":{"content_type":"image/png","hash":"5e0f8a071676de64ed7511ef98143137","path":"/5e0f8a071676de64ed7511ef98143137.png"},"text/plain":{"content":"plot without title","content_type":"text/plain"}}}],"key":"RAjbz5EVsQ"}],"key":"m7F3PWVnE0"},{"type":"block","kind":"notebook-content","data":{"nteract":{"transient":{"deleting":false}}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Arrange and Save","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i27qfiWMsX"}],"identifier":"arrange-and-save","label":"Arrange and Save","html_id":"arrange-and-save","implicit":true,"key":"ClJb6aMeiu"}],"key":"IuiJERXSC1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-08-16T18:41:58.541Z","iopub.status.busy":"2021-08-16T18:41:58.536Z","iopub.status.idle":"2021-08-16T18:41:59.677Z","shell.execute_reply":"2021-08-16T18:41:59.770Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"ggarrange(\n  ggarrange(\n    k_plot,\n    dapc_plot,\n    ncol = 2, labels = c(\"A\", \"B\")\n  ),\n  posterior_plot,\n  nrow = 2,\n  labels = c(\"\", \"C\"),\n  heights = c(2, 1.5)\n)","key":"I7XQjchOj6"},{"type":"output","id":"ZshnB9oF9kYSVqkpFTmBm","data":[{"output_type":"display_data","metadata":{"image/png":{"height":420,"width":420}},"data":{"image/png":{"content_type":"image/png","hash":"675dc5d891e4de7c6e5cd4f04e369c89","path":"/675dc5d891e4de7c6e5cd4f04e369c89.png"},"text/plain":{"content":"plot without title","content_type":"text/plain"}}}],"key":"UZtFKVsazJ"}],"key":"rz1SMqtzZS"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"execution":{"iopub.execute_input":"2021-08-16T18:41:59.757Z","iopub.status.busy":"2021-08-16T18:41:59.748Z","iopub.status.idle":"2021-08-16T18:42:00.190Z","shell.execute_reply":"2021-08-16T18:42:00.183Z"},"jupyter":{"outputs_hidden":false,"source_hidden":false},"nteract":{"transient":{"deleting":false}}},"children":[{"type":"code","lang":"python","executable":true,"value":"ggsave(\"DAPC_neutral.png\", height = 6, width = 11, units = \"in\")","key":"kcWFlU6p5S"},{"type":"output","id":"nDct_B3z48gnhs7dkLKJU","data":[],"key":"Vdgmmz6Izz"}],"key":"pvpoypmn8q"}],"key":"pWlyK0aHOM"},"references":{"cite":{"order":[],"data":{}}}}